<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChetGPT Work Board</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Plus+Jakarta+Sans:wght@500;600;700;800&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #F7F8FA;
            --text: #1A1D23;
            --text-secondary: rgba(26, 29, 35, 0.65);
            --text-muted: rgba(26, 29, 35, 0.42);
            --text-subtle: rgba(26, 29, 35, 0.25);

            --accent-teal: #0097B2;
            --accent-teal-deep: #007A94;
            --accent-purple: #6C63FF;
            --accent-purple-deep: #5951D8;
            --accent-purple-soft: #8B83FF;
            --accent-rose: #D47EB8;
            --accent-amber: #C4962E;
            --accent-green: #22A85F;
            --accent-red: #E04848;

            --glass-strong: rgba(255, 255, 255, 0.75);
            --glass-medium: rgba(255, 255, 255, 0.72);
            --glass-faint: rgba(255, 255, 255, 0.85);

            --radius-card: 16px;
            --radius-panel: 20px;
            --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.04), 0 8px 24px rgba(0, 0, 0, 0.06);
            --shadow-card-hover: 0 4px 12px rgba(0, 0, 0, 0.06), 0 16px 40px rgba(0, 0, 0, 0.10);
            --shadow-panel: 0 1px 3px rgba(0, 0, 0, 0.04), 0 4px 16px rgba(0, 0, 0, 0.06);

            --font-display: 'Plus Jakarta Sans', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-mono: 'Roboto Mono', ui-monospace, SFMono-Regular, Menlo, monospace;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 32px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            background:
                radial-gradient(ellipse 60% 50% at 10% 12%, rgba(0, 151, 178, 0.05), transparent 55%),
                radial-gradient(ellipse 55% 55% at 85% 10%, rgba(108, 99, 255, 0.05), transparent 50%),
                radial-gradient(ellipse 50% 60% at 70% 80%, rgba(212, 126, 184, 0.04), transparent 50%),
                radial-gradient(ellipse 60% 50% at 22% 85%, rgba(0, 122, 148, 0.04), transparent 50%);
            filter: blur(6px);
        }

        body::after {
            content: '';
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.3) 0%, transparent 36%, rgba(255,255,255,0.12) 100%);
        }

        .container {
            max-width: 1680px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            padding-bottom: 18px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        h1 {
            font-family: var(--font-display);
            font-size: clamp(1.45rem, 2.1vw, 2rem);
            font-weight: 700;
            font-style: normal;
            letter-spacing: -0.02em;
            line-height: 1.08;
            color: var(--text);
        }

        h1 em {
            color: var(--accent-teal);
            font-style: normal;
        }

        .last-sync {
            margin-top: 8px;
            display: inline-block;
            font-family: var(--font-mono);
            font-size: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .header-actions {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-end;
            gap: 10px;
        }

        #taskInput,
        #tagSelect {
            border: 1px solid rgba(0, 0, 0, 0.10);
            background: rgba(255, 255, 255, 0.88);
            color: var(--text);
            border-radius: 780px;
            height: 42px;
            padding: 0 20px;
            font-family: var(--font-body);
            font-size: 13px;
            outline: none;
            backdrop-filter: blur(20px);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        #taskInput { width: 320px; }
        #taskInput::placeholder { color: var(--text-muted); }
        #taskInput:focus,
        #tagSelect:focus {
            border-color: rgba(0, 151, 178, 0.5);
            box-shadow: 0 0 0 4px rgba(0, 151, 178, 0.12);
        }
        #tagSelect { cursor: pointer; min-width: 120px; }

        .btn {
            height: 42px;
            border: none;
            border-radius: 780px;
            padding: 0 22px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            font-family: var(--font-body);
            cursor: pointer;
            transition: transform 0.35s ease, box-shadow 0.35s ease;
        }

        .btn-primary {
            color: #fff;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-teal-deep));
            box-shadow: 0 10px 24px rgba(0, 151, 178, 0.25);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 14px 30px rgba(0, 151, 178, 0.35);
        }

        .btn-sync {
            color: var(--text-secondary);
            background: rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(0, 0, 0, 0.10);
        }

        .btn-sync:hover {
            color: var(--text);
            transform: translateY(-1px);
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 20px;
            padding: 18px 28px;
            border-radius: 780px;
            background: var(--glass-medium);
            border: 1px solid rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(24px);
            box-shadow: var(--shadow-panel);
        }

        .stat-item {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .stat-label {
            font-size: 9px;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .stat-value {
            font-family: var(--font-mono);
            font-size: 22px;
            font-weight: 600;
            letter-spacing: -0.04em;
            color: var(--text);
        }

        .fuel-gauge {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            padding: 16px 22px;
            border-radius: var(--radius-panel);
            background: var(--glass-medium);
            border: 1px solid rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(24px);
            box-shadow: var(--shadow-panel);
        }

        .fuel-item {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }

        .fuel-label,
        .fuel-thinking-label {
            font-size: 9px;
            letter-spacing: 0.14em;
            text-transform: uppercase;
            color: var(--text-muted);
            white-space: nowrap;
            min-width: 54px;
        }

        .fuel-bar-wrap {
            flex: 1;
            height: 4px;
            border-radius: 999px;
            background: rgba(0, 0, 0, 0.06);
            overflow: hidden;
            min-width: 90px;
        }

        .fuel-bar-fill {
            height: 100%;
            border-radius: inherit;
            transition: width 0.8s ease, opacity 0.4s ease;
        }

        .fuel-bar-fill.green { background: linear-gradient(90deg, var(--accent-teal-deep), var(--accent-teal)); }
        .fuel-bar-fill.yellow { background: linear-gradient(90deg, #B98B2F, #D7A84B); }
        .fuel-bar-fill.red { background: linear-gradient(90deg, #CE72A8, var(--accent-red)); }
        .fuel-bar-fill.red-pulse {
            background: linear-gradient(90deg, #CE72A8, var(--accent-red));
            animation: fuelPulse 1.8s ease-in-out infinite;
        }

        @keyframes fuelPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.45; }
        }

        .fuel-pct {
            min-width: 36px;
            text-align: right;
            font-family: var(--font-mono);
            font-size: 11px;
            letter-spacing: -0.02em;
        }

        .fuel-pct.green { color: var(--accent-teal); }
        .fuel-pct.yellow { color: var(--accent-amber); }
        .fuel-pct.red { color: var(--accent-red); }

        .fuel-reset,
        .fuel-updated {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-subtle);
            white-space: nowrap;
        }

        .fuel-model {
            padding: 6px 14px;
            border-radius: 780px;
            font-size: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            font-family: var(--font-mono);
            white-space: nowrap;
            font-weight: 500;
        }

        .fuel-model.ok {
            color: var(--accent-purple);
            background: rgba(108, 99, 255, 0.06);
            border: 1px solid rgba(108, 99, 255, 0.22);
        }

        .fuel-model.fallback {
            color: var(--accent-amber);
            background: rgba(196, 150, 46, 0.10);
            border: 1px solid rgba(196, 150, 46, 0.28);
            animation: fuelPulse 2s ease-in-out infinite;
        }

        .fuel-thinking {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .thinking-pill {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.8);
            font-size: 10px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--text-muted);
            white-space: nowrap;
        }

        .thinking-pill::before {
            content: '';
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .thinking-pill.high::before { background: #CE72A8; }
        .thinking-pill.medium::before { background: #D7A84B; }
        .thinking-pill.low::before { background: #4DBF7C; }

        .thinking-pill .pill-count {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--text-secondary);
        }

        .thinking-active {
            font-size: 10px;
            color: var(--text-subtle);
            font-style: normal;
            font-family: var(--font-mono);
        }

        .filter-bar {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding: 10px 16px;
            border-radius: 780px;
            background: var(--glass-medium);
            border: 1px solid rgba(0, 0, 0, 0.06);
            backdrop-filter: blur(24px);
            box-shadow: var(--shadow-panel);
        }

        .filter-label {
            padding: 0 12px;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--text-muted);
        }

        .filter-pill {
            border-radius: 780px;
            border: 1px solid rgba(0, 0, 0, 0.10);
            background: transparent;
            color: var(--text-muted);
            padding: 7px 16px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            cursor: pointer;
            transition: border-color 0.3s ease, color 0.3s ease, transform 0.3s ease;
            font-family: var(--font-body);
            font-weight: 500;
        }

        .filter-pill:hover {
            color: var(--text-secondary);
            border-color: rgba(0, 0, 0, 0.20);
            transform: translateY(-1px);
        }

        .filter-pill.active {
            color: var(--text);
            border-color: rgba(0, 151, 178, 0.55);
        }

        .filter-pill.active-setup { color: #22A85F; border-color: rgba(34, 168, 95, 0.4); background: transparent; }
        .filter-pill.active-scraping { color: #B1842D; border-color: rgba(177, 132, 45, 0.4); background: transparent; }
        .filter-pill.active-research { color: var(--accent-purple); border-color: rgba(108, 99, 255, 0.4); background: transparent; }
        .filter-pill.active-MIS { color: var(--accent-teal-deep); border-color: rgba(0, 151, 178, 0.4); background: transparent; }
        .filter-pill.active-infra { color: #9A7A29; border-color: rgba(154, 122, 41, 0.4); background: transparent; }

        .page-loaded {
            margin-left: auto;
            font-family: var(--font-mono);
            font-size: 10px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--text-subtle);
            padding-right: 12px;
        }

        .changelog-wrap { margin-bottom: 22px; }

        .changelog-toggle {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 20px;
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: var(--radius-card);
            background: var(--glass-medium);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-panel);
            color: rgba(0, 122, 148, 0.92);
            font-size: 12px;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            cursor: pointer;
            font-family: var(--font-body);
            text-align: left;
            transition: box-shadow 0.3s ease;
        }

        .changelog-toggle:hover {
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.10);
        }

        .changelog-toggle .badge {
            margin-left: 6px;
            border-radius: 999px;
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 700;
            padding: 2px 9px;
            color: #fff;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-teal-deep));
        }

        .changelog-panel {
            margin-top: 8px;
            padding: 14px 18px;
            border-radius: var(--radius-card);
            border: 1px solid rgba(0, 0, 0, 0.06);
            background: rgba(255, 255, 255, 0.86);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-panel);
            display: none;
        }

        .changelog-panel.open { display: block; }

        .changelog-item {
            font-size: 12px;
            color: var(--text-secondary);
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        }

        .changelog-item:last-child { border-bottom: none; }
        .changelog-item .cl-icon { margin-right: 6px; }
        .changelog-item .cl-task { color: var(--text); font-weight: 500; }
        .changelog-item .cl-detail { color: var(--text-muted); font-size: 11px; }

        .changelog-more {
            border: none;
            background: none;
            color: rgba(0, 122, 148, 0.9);
            cursor: pointer;
            font-size: 11px;
            padding-top: 8px;
            font-family: var(--font-body);
            font-weight: 600;
        }

        .changelog-more:hover { text-decoration: underline; }

        .changelog-empty {
            font-style: normal;
            color: var(--text-muted);
            font-size: 12px;
            padding: 8px 0;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 20px;
        }

        .column {
            min-height: 520px;
            padding: 22px;
            border-radius: var(--radius-panel);
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(24px);
            box-shadow: var(--shadow-panel);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: transform 0.4s ease, box-shadow 0.4s ease;
        }

        .column:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 18px 44px rgba(0, 0, 0, 0.10);
        }

        .chet-active {
            animation: chetBreathing 6s ease-in-out infinite;
            box-shadow:
                var(--shadow-panel),
                0 0 30px rgba(108, 99, 255, 0.08),
                0 0 0 1px rgba(108, 99, 255, 0.10);
        }

        @keyframes chetBreathing {
            0%, 100% {
                box-shadow:
                    var(--shadow-panel),
                    0 0 24px rgba(108, 99, 255, 0.06),
                    0 0 0 1px rgba(108, 99, 255, 0.08);
            }
            50% {
                box-shadow:
                    0 2px 8px rgba(0, 0, 0, 0.04),
                    0 12px 30px rgba(0, 0, 0, 0.08),
                    0 0 46px rgba(108, 99, 255, 0.12),
                    0 0 0 1px rgba(108, 99, 255, 0.16);
            }
        }

        .column-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        .column-header.toggleable {
            cursor: pointer;
            user-select: none;
        }

        .chevron {
            width: 12px;
            color: var(--text-muted);
            font-size: 10px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .column-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .backlog .column-icon { background: var(--accent-amber); }
        .in-progress .column-icon { background: var(--accent-teal); }
        .chet-active .column-icon { background: var(--accent-purple); }
        .done .column-icon { background: var(--accent-green); }

        .column-title,
        #backlog-title {
            font-family: var(--font-display);
            font-size: 18px;
            font-style: normal;
            font-weight: 700;
            letter-spacing: -0.015em;
            line-height: 1.2;
            flex: 1;
            min-width: 0;
            color: var(--text);
        }

        .column-title-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
            min-width: 0;
        }

        .column-subtitle {
            font-family: var(--font-mono);
            font-size: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .task-count {
            border-radius: 999px;
            background: rgba(0, 0, 0, 0.04);
            color: var(--text-secondary);
            min-width: 28px;
            height: 24px;
            padding: 0 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 500;
            border: 1px solid rgba(0, 0, 0, 0.06);
        }

        .column-body {
            overflow: hidden;
            transition: max-height 0.36s ease, opacity 0.36s ease;
            max-height: 1700px;
            opacity: 1;
        }

        .column-body.collapsed {
            max-height: 0;
            opacity: 0;
            pointer-events: none;
        }

        .tasks {
            display: flex;
            flex-direction: column;
            gap: 14px;
            min-height: 340px;
        }

        .task {
            position: relative;
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-left: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: var(--radius-card);
            padding: 20px 22px;
            background: #FFFFFF;
            box-shadow: var(--shadow-card);
            cursor: grab;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
        }

        .task:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-card-hover);
        }

        .task.dragging { opacity: 0.4; }

        .chet-active .task {
            border-left: 1px solid rgba(108, 99, 255, 0.18);
            animation: none;
        }

        .chet-active .task:hover {
            animation: none;
        }

        .task.priority-critical {
            background: rgba(194, 150, 46, 0.06);
            border: 1px solid rgba(194, 150, 46, 0.15);
            animation: none;
        }

        .task.priority-critical:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-card-hover);
        }

        .task.priority-high {
            background: rgba(212, 126, 184, 0.06);
            border: 1px solid rgba(212, 126, 184, 0.15);
            animation: none;
        }

        .chet-active .task.priority-high { animation: none; }

        .task.priority-high:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-card-hover);
        }

        .priority-badge-critical {
            display: inline-block;
            margin-left: 8px;
            padding: 2px 9px;
            border-radius: 999px;
            font-family: var(--font-mono);
            font-size: 9px;
            font-weight: 500;
            letter-spacing: 0.06em;
            vertical-align: middle;
            color: #9A7019;
            background: rgba(194, 150, 46, 0.14);
            border: none;
        }

        .priority-badge {
            display: inline-block;
            margin-left: 8px;
            padding: 2px 9px;
            border-radius: 999px;
            font-family: var(--font-mono);
            font-size: 9px;
            font-weight: 500;
            letter-spacing: 0.06em;
            vertical-align: middle;
            color: #A34A84;
            background: rgba(212, 126, 184, 0.14);
            border: none;
        }

        .task-text {
            display: block;
            padding-right: 24px;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text);
            word-break: break-word;
        }

        .task-meta {
            margin-top: 12px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 11px;
            color: var(--text-muted);
        }

        .task-tag {
            display: inline-flex;
            align-items: center;
            border-radius: 999px;
            padding: 3px 10px;
            font-size: 10px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            font-weight: 500;
            border: 1px solid transparent;
        }

        .tag-setup { background: rgba(34, 168, 95, 0.08); color: #1D8D4E; border-color: rgba(34, 168, 95, 0.18); }
        .tag-scraping { background: rgba(196, 150, 46, 0.08); color: #8B6617; border-color: rgba(196, 150, 46, 0.18); }
        .tag-research { background: rgba(108, 99, 255, 0.08); color: #5A52E0; border-color: rgba(108, 99, 255, 0.18); }
        .tag-MIS { background: rgba(0, 151, 178, 0.08); color: #007A94; border-color: rgba(0, 151, 178, 0.18); }
        .tag-infra { background: rgba(154, 122, 41, 0.08); color: #7C6220; border-color: rgba(154, 122, 41, 0.18); }

        .delete-btn {
            position: absolute;
            top: 12px;
            right: 14px;
            border: none;
            background: transparent;
            color: rgba(26, 29, 35, 0.28);
            cursor: pointer;
            font-size: 20px;
            line-height: 1;
            width: auto;
            height: auto;
            opacity: 0;
            transition: opacity 0.3s ease, color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0;
        }

        .task:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { color: rgba(224, 72, 72, 0.9); background: transparent; }

        .empty-state {
            text-align: center;
            padding: 64px 20px;
            font-family: var(--font-display);
            font-style: normal;
            font-weight: 600;
            font-size: 16px;
            color: var(--text-muted);
            letter-spacing: 0;
        }

        .toggle-link {
            margin-top: 16px;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-size: 11px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            cursor: pointer;
            font-family: var(--font-body);
            padding: 0;
            text-align: left;
            transition: color 0.2s;
        }

        .toggle-link:hover { color: var(--text); }

        #live-update-banner {
            position: fixed;
            left: 50%;
            bottom: 28px;
            transform: translateX(-50%);
            z-index: 9999;
            border-radius: 780px;
            padding: 14px 30px;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-teal-deep));
            color: #fff;
            font-size: 12px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-weight: 600;
            box-shadow: 0 16px 36px rgba(0, 151, 178, 0.3);
            cursor: pointer;
            animation: slideUp 0.4s ease-out;
            font-family: var(--font-body);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateX(-50%) translateY(16px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        @keyframes activeGlow { 0%, 100% {} }
        @keyframes criticalGlow { 0%, 100% {} }
        @keyframes highGlow { 0%, 100% {} }
        @keyframes iconPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 0, 0, 0.12) transparent;
        }

        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.12); border-radius: 999px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(0, 0, 0, 0.22); }

        @media (max-width: 1320px) {
            header { flex-direction: column; align-items: stretch; }
            .header-actions { justify-content: flex-start; }
            #taskInput { width: min(100%, 400px); }

            .board {
                display: flex !important;
                flex-wrap: nowrap !important;
                overflow-x: auto !important;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
                touch-action: pan-x pan-y;
                gap: 20px;
                padding-bottom: 14px;
            }

            .column {
                min-width: 74vw;
                max-width: 74vw;
                flex-shrink: 0;
                scroll-snap-align: start;
            }

            .stats-bar { flex-wrap: wrap; gap: 16px; }
        }

        @media (max-width: 740px) {
            body { padding: 20px; }
            .stats-bar { border-radius: var(--radius-panel); gap: 16px; }
            .filter-bar { border-radius: var(--radius-panel); }
            .column { min-width: 87vw; max-width: 87vw; padding: 18px; }
            h1 { font-size: 1.45rem; }
            .fuel-item { min-width: 100%; }
            .fuel-reset { display: none; }
        }
    </style>

</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>ChetGPT <em>Work</em> Board</h1>
                <span class="last-sync" id="lastSync">Last sync: --</span>
            </div>
            <div class="header-actions">
                <input type="text" id="taskInput" placeholder="Add a work task..." maxlength="220">
                <select id="tagSelect" aria-label="Task tag">
                    <option value="setup">setup</option>
                    <option value="scraping">scraping</option>
                    <option value="research">research</option>
                    <option value="MIS">MIS</option>
                    <option value="infra">infra</option>
                </select>
                <label style="display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text-muted);cursor:pointer;user-select:none;letter-spacing:0.06em;text-transform:uppercase;">
                    <input type="checkbox" id="priorityCheck" style="accent-color:var(--accent-purple);width:14px;height:14px;"> High
                </label>
                <button class="btn btn-primary" id="addBtn">Add</button>
                <button class="btn btn-sync" id="syncBtn">Sync</button>
            </div>
        </header>

        <div class="stats-bar" id="statsBar">
            <div class="stat-item"><span class="stat-label">Backlog</span><span class="stat-value" id="statBacklog">0</span></div>
            <div class="stat-item"><span class="stat-label">In Progress</span><span class="stat-value" id="statInProgress">0</span></div>
            <div class="stat-item"><span class="stat-label">Active</span><span class="stat-value" id="statActive">0</span></div>
            <div class="stat-item"><span class="stat-label">Done</span><span class="stat-value" id="statDone">0</span></div>
            <div class="stat-item"><span class="stat-label">Total</span><span class="stat-value" id="statTotal">0</span></div>
        </div>

        <div class="fuel-gauge" id="fuelGauge">
            <div class="fuel-item">
                <span class="fuel-label">Session</span>
                <div class="fuel-bar-wrap"><div class="fuel-bar-fill" id="fuelSessionBar" style="width:0%"></div></div>
                <span class="fuel-pct" id="fuelSessionPct">--%</span>
                <span class="fuel-reset" id="fuelSessionReset"></span>
            </div>
            <div class="fuel-item">
                <span class="fuel-label">Weekly</span>
                <div class="fuel-bar-wrap"><div class="fuel-bar-fill" id="fuelWeeklyBar" style="width:0%"></div></div>
                <span class="fuel-pct" id="fuelWeeklyPct">--%</span>
                <span class="fuel-reset" id="fuelWeeklyReset"></span>
            </div>
            <span class="fuel-model ok" id="fuelModel">--</span>
            <div class="fuel-thinking" id="fuelThinking">
                <span class="fuel-thinking-label">Thinking</span>
                <span class="thinking-pill high" id="thinkHigh">H <span class="pill-count">0</span></span>
                <span class="thinking-pill medium" id="thinkMed">M <span class="pill-count">0</span></span>
                <span class="thinking-pill low" id="thinkLow">L <span class="pill-count">0</span></span>
                <span class="thinking-active" id="thinkActive"></span>
            </div>
            <span class="fuel-updated" id="fuelUpdated">--</span>
        </div>

        <div class="filter-bar" id="filterBar">
            <span class="filter-label">Filter</span>
            <button class="filter-pill active" data-filter="all">All</button>
            <button class="filter-pill" data-filter="MIS">MIS</button>
            <button class="filter-pill" data-filter="setup">Setup</button>
            <button class="filter-pill" data-filter="scraping">Scraping</button>
            <button class="filter-pill" data-filter="research">Research</button>
            <button class="filter-pill" data-filter="infra">Infra</button>
            <span class="page-loaded" id="pageLoaded">Loaded: --</span>
        </div>

        <div class="changelog-wrap" id="changelogWrap" style="display:none;">
            <button class="changelog-toggle" id="changelogToggle">
                <span id="changelogTitle">Changes since last visit</span>
            </button>
            <div class="changelog-panel" id="changelogPanel"></div>
        </div>

        <div class="board">
            <div class="column backlog" data-column="backlog">
                <div class="column-header toggleable" id="backlog-toggle" role="button" tabindex="0" aria-expanded="false">
                    <span class="chevron" id="backlog-chevron">â–¶</span>
                    <div class="column-icon"></div>
                    <span class="column-title" id="backlog-title">Backlog (0)</span>
                    <span class="task-count" id="backlog-count">0</span>
                </div>
                <div class="column-body collapsed" id="backlog-body">
                    <div class="tasks" id="backlog"></div>
                </div>
            </div>

            <div class="column in-progress" data-column="inProgress">
                <div class="column-header">
                    <div class="column-icon"></div>
                    <span class="column-title">In Progress</span>
                    <span class="task-count" id="inProgress-count">0</span>
                </div>
                <div class="tasks" id="inProgress"></div>
                <div id="inProgress-more-wrap"></div>
            </div>

            <div class="column chet-active" data-column="chetActive">
                <div class="column-header">
                    <div class="column-icon"></div>
                    <span class="column-title">ChetGPT Active</span>
                    <span class="task-count" id="chetActive-count">0</span>
                </div>
                <div class="tasks" id="chetActive"></div>
            </div>

            <div class="column done" data-column="done">
                <div class="column-header">
                    <div class="column-icon"></div>
                    <div class="column-title-group">
                        <span class="column-title">Today's Wins</span>
                        <span class="column-subtitle" id="done-subtitle">0 total all-time</span>
                    </div>
                    <span class="task-count" id="done-count">0</span>
                </div>
                <div class="tasks" id="done"></div>
                <div id="done-view-all-wrap"></div>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'kanban_work_v1';
        const COLUMNS = ['backlog', 'inProgress', 'chetActive', 'done'];
        let tasks = [];
        let draggedTask = null;
        let activeFilter = 'all';
        const UI_STATE = {
            backlogExpanded: false,
            inProgressExpanded: false,
            doneShowAll: false
        };

        // ============================================================
        // WORK TASKS ONLY (source: chet)
        // Columns: backlog, inProgress, chetActive, done
        // Tags: setup, scraping, research, MIS, infra
        // ============================================================
        const CHET_TASKS = [
            // === DONE (today) ===
            { id: 'c1', text: 'âœ… Verified session memory search is enabled', column: 'done', tag: 'setup', source: 'chet', completedAt: '2026-02-12T19:00:00Z' },
            { id: 'vault1', text: 'âœ… Read & analyzed INKredible Vault (116 files) â€” full business context loaded', column: 'done', tag: 'MIS', source: 'chet', completedAt: '2026-02-12T20:30:00Z' },
            { id: 'mis1', text: 'âœ… MIS Phase 1: Extractor + 164 PDFs + Vault pulled into workspace', column: 'done', tag: 'MIS', source: 'chet', completedAt: '2026-02-12T21:20:00Z' },
            { id: 'gh1', text: 'âœ… Deploy Kanban to GitHub Pages', column: 'done', tag: 'infra', source: 'chet', completedAt: '2026-02-12T20:44:00Z' },
            { id: 'gh2', text: 'âœ… INKredible Extractor on GitHub â€” pulled to workspace', column: 'done', tag: 'infra', source: 'chet', completedAt: '2026-02-12T21:15:00Z' },
            { id: 'c15', text: 'âœ… Install Codex CLI v0.101.0 as coding muscle', column: 'done', tag: 'setup', source: 'chet', completedAt: '2026-02-12T21:30:00Z' },
            { id: 'c12', text: 'âœ… Install jq 1.7.1 + ripgrep 14.1.1', column: 'done', tag: 'setup', source: 'chet', completedAt: '2026-02-12T21:32:00Z' },
            { id: 'c9', text: 'âœ… Configure memory search (Google Gemini embeddings)', column: 'done', tag: 'setup', source: 'chet', completedAt: '2026-02-12T19:30:00Z' },
            { id: 'fuel1', text: 'âœ… Built fuel gauge â€” live usage tracker on Kanban board', column: 'done', tag: 'infra', source: 'chet', completedAt: '2026-02-12T22:08:00Z' },

            // === CHETGPT ACTIVE (working on right now) ===
            { id: 'mis2', text: 'ðŸ”§ MIS Phase 2: Get Extractor running (npm install + dev server + test PDFs)', column: 'chetActive', tag: 'MIS', source: 'chet' },
            { id: 'tm1', text: 'ðŸ“‹ Review team meeting transcript (Feb 9) â€” cash flow analysis with vault context', column: 'chetActive', tag: 'MIS', source: 'chet', priority: 'high' },

            // === IN PROGRESS (waiting on Aviel) ===
            { id: 'qb1', text: 'ðŸ“Š Export QuickBooks P&L + Balance Sheet â†’ send to ChetGPT â†’ build real financial dashboard', column: 'inProgress', tag: 'MIS', source: 'chet', priority: 'critical' },
            { id: 'inv1', text: 'âœ… Sent invoice to Shachar', column: 'done', tag: 'MIS', source: 'chet', completedAt: '2026-02-13T02:59:00Z' },
            { id: 'fin1', text: 'ðŸ’° Get business + personal finance numbers into ChetGPT', column: 'inProgress', tag: 'MIS', source: 'chet', priority: 'high' },
            { id: 'tm2', text: 'ðŸ“± Upload Brandon meeting recording (Feb 12) from Z-Fold 7', column: 'inProgress', tag: 'MIS', source: 'chet', priority: 'high' },
            { id: 'c13', text: 'ðŸ§  Deeper brain dump â€” who Aviel really is, patterns, flaws', column: 'inProgress', tag: 'setup', source: 'chet', priority: 'high' },

            // === BACKLOG ===
            { id: 'ext1', text: 'ðŸ“Š Extracting material costs â€” Lindenmeyr âœ… 28 items | Ddpmsc running (71 PDFs)', column: 'chetActive', tag: 'MIS', source: 'chet' },
            { id: 'kanban1', text: 'ðŸ”§ Kanban board: fuel gauge + filters + changelog + timestamps', column: 'done', tag: 'infra', source: 'chet', completedAt: '2026-02-12T22:49:00Z' },
            { id: 'mis3', text: 'MIS Phase 3: Scrape 8 NDF products (Codex 5.3)', column: 'backlog', tag: 'MIS', source: 'chet' },
            { id: 'mis4', text: 'MIS Phase 4: Build pricing engine (costs + NDF 3-tier)', column: 'backlog', tag: 'MIS', source: 'chet' },
            { id: 'mis5', text: 'MIS Phase 5: Inventory + FIFO lot tracking', column: 'backlog', tag: 'MIS', source: 'chet' },
            { id: 'llm1', text: 'ðŸ§  Set up local LLMs (Ollama) â€” free AI for heartbeat, extraction, simple tasks', column: 'backlog', tag: 'infra', source: 'chet', priority: 'high' },
            { id: 'c14', text: 'ðŸ”„ Reverse prompting session â€” unlock proactive behavior', column: 'backlog', tag: 'setup', source: 'chet' },
            { id: 'c16', text: 'ðŸ› ï¸ Build custom pricing calculator skill', column: 'backlog', tag: 'setup', source: 'chet' },
            { id: 'c17', text: 'ðŸ› ï¸ Build custom invoice extractor skill', column: 'backlog', tag: 'setup', source: 'chet' },
            { id: 'c18', text: 'ðŸ’¬ Set up Discord as multi-agent workspace', column: 'backlog', tag: 'setup', source: 'chet' },
            { id: 'c19', text: 'ðŸ“Š Afternoon research report (printing industry trends)', column: 'backlog', tag: 'research', source: 'chet' },
            { id: 'c20', text: 'ðŸ› ï¸ Build customer quote generator skill', column: 'backlog', tag: 'setup', source: 'chet' },
            { id: 'c21', text: 'ðŸ› ï¸ Build paper stock lookup skill', column: 'backlog', tag: 'setup', source: 'chet' },
            { id: 'c4', text: 'Complete 5x7 NDF postcard scrape (qty 2000-5000 + double-sided)', column: 'backlog', tag: 'scraping', source: 'chet' },
            { id: 'c5', text: 'Scrape 4x6 NDF postcards (single + double sided)', column: 'backlog', tag: 'scraping', source: 'chet' },
            { id: 'c6', text: 'Scrape 6x9 NDF postcards (single + double sided)', column: 'backlog', tag: 'scraping', source: 'chet' },
            { id: 'c7', text: 'Find NDF internal pricing API (bypass slow browser)', column: 'backlog', tag: 'research', source: 'chet' },
            { id: 'c8', text: 'Fund DeepSeek API ($5 at platform.deepseek.com)', column: 'backlog', tag: 'setup', source: 'chet' },
            { id: 'c10', text: 'Create unified OpenClaw command aliases + shortcuts', column: 'backlog', tag: 'setup', source: 'chet' },
            { id: 'c11', text: 'Set up repeatable daily execution checklist', column: 'backlog', tag: 'setup', source: 'chet' },

            // === DONE (older) ===
            { id: 'd1', text: 'âœ… Upgraded to Opus 4.6', column: 'done', tag: 'setup', source: 'chet' },
            { id: 'd2', text: 'âœ… Confirmed GPT-5.2 working (Codex OAuth)', column: 'done', tag: 'setup', source: 'chet' },
            { id: 'd3', text: 'âœ… Configured Brave Search API', column: 'done', tag: 'setup', source: 'chet' },
            { id: 'd4', text: 'âœ… Installed YouTube transcript tool', column: 'done', tag: 'setup', source: 'chet' },
            { id: 'd5', text: 'âœ… Pulled 11 Alex Finn transcripts (55,903 words)', column: 'done', tag: 'research', source: 'chet' },
            { id: 'd6', text: 'âœ… Removed broken gpt-4o-codex model', column: 'done', tag: 'setup', source: 'chet' },
            { id: 'd7', text: 'âœ… Updated OpenClaw to 2026.2.9', column: 'done', tag: 'setup', source: 'chet' },
            { id: 'd8', text: 'âœ… Set up morning brief cron (8AM Mon-Fri)', column: 'done', tag: 'setup', source: 'chet' },
            { id: 'd9', text: 'âœ… Built Kanban board + cost tracking', column: 'done', tag: 'setup', source: 'chet' },
            { id: 'd10', text: 'âœ… 5x7 postcards partial scrape (qty 25-1000)', column: 'done', tag: 'scraping', source: 'chet' },
            { id: 'd11', text: 'âœ… Analyzed 11 Alex Finn transcripts (55,903 words)', column: 'done', tag: 'research', source: 'chet' },
            { id: 'd12', text: 'âœ… Extracted action items from all transcripts', column: 'done', tag: 'research', source: 'chet' },
            { id: 'd13', text: 'âœ… YouTube transcript tool installed', column: 'done', tag: 'setup', source: 'chet' }
        ];
        // SYNC_TIMESTAMP: 2026-02-13T03:01:00Z
        // ============================================================

        document.addEventListener('DOMContentLoaded', () => {
            syncTasks();
            loadTasks();
            renderTasks();
            setupEventListeners();
            updateSyncTime();
            runChangelog();
        });

        function syncTasks() {
            const stored = localStorage.getItem(STORAGE_KEY);
            let existing = [];
            if (stored) { try { existing = JSON.parse(stored); } catch(e) { existing = []; } }
            const canonicalIds = new Set(CHET_TASKS.map(t => t.id));
            const userMoved = {};
            const existingTaskById = {};
            existing.forEach(t => {
                if (canonicalIds.has(t.id)) {
                    existingTaskById[t.id] = t;
                    if (t._userMoved) userMoved[t.id] = t.column;
                }
            });
            const userTasks = existing.filter(t => !canonicalIds.has(t.id));
            const merged = CHET_TASKS.map(t => {
                const prior = existingTaskById[t.id] || {};
                return { ...t, source: 'chet', column: userMoved[t.id] || t.column, _userMoved: !!userMoved[t.id], createdAt: prior.createdAt || t.createdAt || new Date().toISOString(), completedAt: prior.completedAt || t.completedAt || null };
            });
            tasks = [...merged, ...userTasks.filter(t => t.source === 'chet')];
            localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
        }

        function updateSyncTime() {
            const match = document.body.innerHTML.match(/SYNC_TIMESTAMP:\s*([^\n<]+)/);
            if (match) {
                const d = new Date(match[1].trim());
                document.getElementById('lastSync').textContent = 'Last sync: ' + d.toLocaleString();
            }
        }

        function loadTasks() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) { try { tasks = JSON.parse(stored); } catch(e) { tasks = []; } }
            tasks = tasks.filter(t => t.source === 'chet');
        }

        function saveTasks() {
            tasks = tasks.filter(t => t.source === 'chet');
            localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
        }

        function generateId() { return 'w' + Date.now().toString(36) + Math.random().toString(36).slice(2); }

        function addTask(text, tag, priority) {
            const trimmed = text.trim();
            if (!trimmed) return;
            tasks.push({ id: generateId(), text: trimmed, column: 'backlog', tag: tag || 'setup', priority: priority || 'normal', source: 'chet', createdAt: new Date().toISOString(), completedAt: null });
            saveTasks();
            renderTasks();
        }

        function deleteTask(id) { tasks = tasks.filter(t => t.id !== id); saveTasks(); renderTasks(); }

        function moveTask(id, newColumn) {
            const task = tasks.find(t => t.id === id);
            if (task && COLUMNS.includes(newColumn)) {
                const oldColumn = task.column;
                task.column = newColumn;
                task._userMoved = true;
                if (newColumn === 'done' && oldColumn !== 'done') task.completedAt = new Date().toISOString();
                saveTasks();
                renderTasks();
            }
        }

        function renderTasks() {
            const columns = { backlog: document.getElementById('backlog'), inProgress: document.getElementById('inProgress'), chetActive: document.getElementById('chetActive'), done: document.getElementById('done') };
            Object.values(columns).forEach(col => col.innerHTML = '');
            const counts = { backlog: 0, inProgress: 0, chetActive: 0, done: 0 };
            const tasksByColumn = { backlog: [], inProgress: [], chetActive: [], done: [] };
            tasks.forEach(task => {
                if (!tasksByColumn[task.column]) return;
                counts[task.column]++;
                if (activeFilter === 'all' || task.tag === activeFilter) tasksByColumn[task.column].push(task);
            });
            const backlogTasks = tasksByColumn.backlog.sort(sortHighPriorityFirst);
            const inProgressTasks = tasksByColumn.inProgress.sort(sortHighPriorityFirst);
            const activeTasks = tasksByColumn.chetActive.sort(sortHighPriorityFirst);
            const doneTasksAll = tasksByColumn.done.sort(sortNewestFirst);
            const doneTasksToday = doneTasksAll.filter(isTaskCompletedToday);
            backlogTasks.forEach(task => columns.backlog.appendChild(createTaskElement(task)));
            const inProgressVisible = UI_STATE.inProgressExpanded ? inProgressTasks : inProgressTasks.slice(0, 3);
            inProgressVisible.forEach(task => columns.inProgress.appendChild(createTaskElement(task)));
            activeTasks.forEach(task => columns.chetActive.appendChild(createTaskElement(task)));
            const doneVisible = UI_STATE.doneShowAll ? doneTasksAll : doneTasksToday;
            doneVisible.forEach(task => columns.done.appendChild(createTaskElement(task)));
            if (backlogTasks.length === 0) columns.backlog.innerHTML = '<div class="empty-state">Nothing queued</div>';
            if (inProgressVisible.length === 0) columns.inProgress.innerHTML = '<div class="empty-state">Clear slate</div>';
            if (activeTasks.length === 0) columns.chetActive.innerHTML = '<div class="empty-state">Standing by</div>';
            if (doneVisible.length === 0) columns.done.innerHTML = doneTasksAll.length > 0 && !UI_STATE.doneShowAll ? '<div class="empty-state">No wins logged today yet</div>' : '<div class="empty-state">Ship something</div>';
            document.getElementById('backlog-count').textContent = counts.backlog;
            document.getElementById('inProgress-count').textContent = counts.inProgress;
            document.getElementById('chetActive-count').textContent = counts.chetActive;
            document.getElementById('done-count').textContent = UI_STATE.doneShowAll ? doneTasksAll.length : doneTasksToday.length;
            document.getElementById('backlog-title').textContent = `Backlog (${counts.backlog})`;
            document.getElementById('done-subtitle').textContent = `${doneTasksAll.length} total all-time`;
            setBacklogCollapsedState();
            renderInProgressToggle(inProgressTasks.length);
            renderDoneToggle(doneTasksAll.length, doneTasksToday.length);
            document.getElementById('statBacklog').textContent = counts.backlog;
            document.getElementById('statInProgress').textContent = counts.inProgress;
            document.getElementById('statActive').textContent = counts.chetActive;
            document.getElementById('statDone').textContent = counts.done;
            document.getElementById('statTotal').textContent = tasks.length;
        }

        function sortHighPriorityFirst(a, b) { const rank = { critical: 0, high: 1 }; return (rank[a.priority] ?? 2) - (rank[b.priority] ?? 2); }
        function sortNewestFirst(a, b) { const aT = a.completedAt ? new Date(a.completedAt).getTime() : 0; const bT = b.completedAt ? new Date(b.completedAt).getTime() : 0; if (isNaN(aT)) return 1; if (isNaN(bT)) return -1; return bT - aT; }
        function isTaskCompletedToday(task) { if (!task.completedAt) return false; const c = new Date(task.completedAt); if (isNaN(c.getTime())) return false; const n = new Date(); return c.getFullYear()===n.getFullYear() && c.getMonth()===n.getMonth() && c.getDate()===n.getDate(); }
        function setBacklogCollapsedState() { const b=document.getElementById('backlog-body'),ch=document.getElementById('backlog-chevron'),tg=document.getElementById('backlog-toggle'); b.classList.toggle('collapsed',!UI_STATE.backlogExpanded); ch.textContent=UI_STATE.backlogExpanded?'â–¼':'â–¶'; tg.setAttribute('aria-expanded',String(UI_STATE.backlogExpanded)); }

        function renderInProgressToggle(total) {
            const wrap = document.getElementById('inProgress-more-wrap'); wrap.innerHTML = '';
            if (total <= 3) return;
            const btn = document.createElement('button'); btn.className = 'toggle-link';
            btn.textContent = UI_STATE.inProgressExpanded ? 'â–¼ Show less' : `â–¶ and ${total - 3} more...`;
            btn.addEventListener('click', () => { UI_STATE.inProgressExpanded = !UI_STATE.inProgressExpanded; renderTasks(); });
            wrap.appendChild(btn);
        }

        function renderDoneToggle(total, today) {
            const wrap = document.getElementById('done-view-all-wrap'); wrap.innerHTML = '';
            const hidden = Math.max(0, total - today);
            if (!UI_STATE.doneShowAll && hidden === 0) return;
            const btn = document.createElement('button'); btn.className = 'toggle-link';
            btn.textContent = UI_STATE.doneShowAll ? 'â–¼ Show today only' : `â–¶ View all (${total})`;
            btn.addEventListener('click', () => { UI_STATE.doneShowAll = !UI_STATE.doneShowAll; renderTasks(); });
            wrap.appendChild(btn);
        }

        function createTaskElement(task) {
            const el = document.createElement('div'); el.className = 'task'; el.draggable = true; el.dataset.id = task.id;
            if (task.priority === 'critical') el.classList.add('priority-critical');
            else if (task.priority === 'high') el.classList.add('priority-high');
            const tagClass = 'tag-' + (task.tag || 'setup');
            const tagLabel = task.tag || 'setup';
            const priorityBadge = task.priority === 'critical' ? '<span class="priority-badge-critical">â­ CRITICAL</span>' : task.priority === 'high' ? '<span class="priority-badge">HIGH</span>' : '';
            let timeStamp = '';
            if (task.completedAt) { const d = new Date(task.completedAt); if (!isNaN(d.getTime())) { const ts = d.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true}); const ds = d.toLocaleDateString('en-US',{month:'short',day:'numeric'}); timeStamp = `<span style="color:var(--text-muted);font-size:10px;margin-left:6px;">âœ… ${ds} ${ts}</span>`; } }
            el.innerHTML = `<span class="task-text">${escapeHtml(task.text)}${priorityBadge}</span><button class="delete-btn" title="Delete">Ã—</button><div class="task-meta"><span class="task-tag ${tagClass}">${tagLabel}</span>${timeStamp}</div>`;
            el.querySelector('.delete-btn').addEventListener('click', (e) => { e.stopPropagation(); deleteTask(task.id); });
            el.addEventListener('dragstart', function(e) { draggedTask = this; this.classList.add('dragging'); e.dataTransfer.setData('text/plain', this.dataset.id); });
            el.addEventListener('dragend', function() { this.classList.remove('dragging'); draggedTask = null; });
            return el;
        }

        function escapeHtml(text) { const d = document.createElement('div'); d.textContent = text; return d.innerHTML; }

        function setupEventListeners() {
            document.getElementById('addBtn').addEventListener('click', () => { const i=document.getElementById('taskInput'),t=document.getElementById('tagSelect').value,p=document.getElementById('priorityCheck').checked?'high':'normal'; addTask(i.value,t,p); i.value=''; document.getElementById('priorityCheck').checked=false; i.focus(); });
            document.getElementById('taskInput').addEventListener('keypress', (e) => { if(e.key==='Enter'){ const t=document.getElementById('tagSelect').value,p=document.getElementById('priorityCheck').checked?'high':'normal'; addTask(e.target.value,t,p); e.target.value=''; document.getElementById('priorityCheck').checked=false; } });
            const bt = document.getElementById('backlog-toggle');
            bt.addEventListener('click', () => { UI_STATE.backlogExpanded=!UI_STATE.backlogExpanded; setBacklogCollapsedState(); });
            bt.addEventListener('keydown', (e) => { if(e.key==='Enter'||e.key===' '){ e.preventDefault(); UI_STATE.backlogExpanded=!UI_STATE.backlogExpanded; setBacklogCollapsedState(); } });
            bt.addEventListener('dragover', (e) => e.preventDefault());
            bt.addEventListener('drop', (e) => { e.preventDefault(); moveTask(e.dataTransfer.getData('text/plain'), 'backlog'); });
            document.querySelectorAll('.filter-pill').forEach(pill => { pill.addEventListener('click', () => { activeFilter=pill.dataset.filter; document.querySelectorAll('.filter-pill').forEach(p => p.className='filter-pill'); pill.className='filter-pill '+(activeFilter==='all'?'active':'active-'+activeFilter); renderTasks(); }); });
            document.getElementById('pageLoaded').textContent = 'Loaded: ' + new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});
            document.getElementById('syncBtn').addEventListener('click', () => { localStorage.removeItem(STORAGE_KEY); syncTasks(); loadTasks(); renderTasks(); alert('Synced work board defaults.'); });
            document.querySelectorAll('.tasks').forEach(column => {
                column.addEventListener('dragover', (e) => { e.preventDefault(); const after=getDragAfterElement(column,e.clientY); const d=document.querySelector('.dragging'); if(!d)return; if(!after)column.appendChild(d); else column.insertBefore(d,after); });
                column.addEventListener('drop', (e) => { e.preventDefault(); moveTask(e.dataTransfer.getData('text/plain'), column.id); });
            });
        }

        function getDragAfterElement(container, y) { return [...container.querySelectorAll('.task:not(.dragging)')].reduce((closest, child) => { const box=child.getBoundingClientRect(); const offset=y-box.top-box.height/2; if(offset<0&&offset>closest.offset) return{offset,element:child}; return closest; },{offset:Number.NEGATIVE_INFINITY}).element; }

        // === CHANGELOG ===
        function runChangelog() {
            const SNAP_KEY='kanban_work_snapshot'; const COL_LABELS={backlog:'Backlog',inProgress:'In Progress',chetActive:'ChetGPT Active',done:'Done'};
            function buildSnapshot(){const s={};tasks.forEach(t=>{s[t.id]={text:t.text,column:t.column,tag:t.tag,priority:t.priority}});return s;}
            function computeChanges(o,n){const c=[];for(const id in n){const cur=n[id],prev=o[id];if(!prev)c.push({type:'added',text:cur.text,to:cur.column});else if(prev.column!==cur.column)c.push({type:'moved',text:cur.text,from:prev.column,to:cur.column});}for(const id in o){if(!n[id])c.push({type:'removed',text:o[id].text,from:o[id].column});}return c;}
            function renderChangelog(changes){
                const wrap=document.getElementById('changelogWrap'),panel=document.getElementById('changelogPanel'),title=document.getElementById('changelogTitle'),toggle=document.getElementById('changelogToggle');
                if(!changes.length){wrap.style.display='none';return;}
                wrap.style.display='block'; title.innerHTML='Changes since last visit <span class="badge">'+changes.length+'</span>';
                const MAX=3; let showAll=false;
                function buildItem(c){const short=c.text.length>55?c.text.slice(0,52)+'...':c.text; if(c.type==='moved'){const icon=c.to==='done'?'âœ…':'âž¡ï¸';return'<div class="changelog-item"><span class="cl-icon">'+icon+'</span><span class="cl-task">'+escapeHtml(short)+'</span> <span class="cl-detail">'+COL_LABELS[c.from]+' â†’ '+COL_LABELS[c.to]+'</span></div>';} else if(c.type==='added'){return'<div class="changelog-item"><span class="cl-icon">âž•</span><span class="cl-task">'+escapeHtml(short)+'</span> <span class="cl-detail">â†’ '+COL_LABELS[c.to]+'</span></div>';} else{return'<div class="changelog-item"><span class="cl-icon">ðŸ—‘ï¸</span><span class="cl-task">'+escapeHtml(short)+'</span> <span class="cl-detail">from '+COL_LABELS[c.from]+'</span></div>';}}
                function renderItems(){const vis=showAll?changes:changes.slice(0,MAX);let h=vis.map(buildItem).join('');if(!showAll&&changes.length>MAX)h+='<button class="changelog-more" id="clShowMore">â–¸ and '+(changes.length-MAX)+' more...</button>';else if(showAll&&changes.length>MAX)h+='<button class="changelog-more" id="clShowLess">â–´ show less</button>';panel.innerHTML=h;const m=document.getElementById('clShowMore'),l=document.getElementById('clShowLess');if(m)m.addEventListener('click',e=>{e.stopPropagation();showAll=true;renderItems();});if(l)l.addEventListener('click',e=>{e.stopPropagation();showAll=false;renderItems();});}
                renderItems(); panel.classList.remove('open'); toggle.addEventListener('click',()=>panel.classList.toggle('open'));
            }
            const oldSnap=JSON.parse(localStorage.getItem(SNAP_KEY)||'{}'); const newSnap=buildSnapshot(); renderChangelog(computeChanges(oldSnap,newSnap)); localStorage.setItem(SNAP_KEY,JSON.stringify(newSnap));
        }

        // === FUEL GAUGE ===
        (function(){
            const FUEL_INTERVAL=60000;
            function fuelColor(p){if(p>=85)return'red-pulse';if(p>=75)return'red';if(p>=50)return'yellow';return'green';}
            function fuelTextColor(p){if(p>=75)return'red';if(p>=50)return'yellow';return'green';}
            function renderFuel(data){
                const sP=data.session.pct||0,sB=document.getElementById('fuelSessionBar'),sT=document.getElementById('fuelSessionPct'),sR=document.getElementById('fuelSessionReset');
                sB.style.width=sP+'%';sB.className='fuel-bar-fill '+fuelColor(sP);sT.textContent=sP+'%';sT.className='fuel-pct '+fuelTextColor(sP);sR.textContent=data.session.resetIn?('â± '+data.session.resetIn):'';
                const wP=data.weekly.pct||0,wB=document.getElementById('fuelWeeklyBar'),wT=document.getElementById('fuelWeeklyPct'),wR=document.getElementById('fuelWeeklyReset');
                wB.style.width=wP+'%';wB.className='fuel-bar-fill '+fuelColor(wP);wT.textContent=wP+'%';wT.className='fuel-pct '+fuelTextColor(wP);wR.textContent=data.weekly.resetAt?('â†» '+data.weekly.resetAt):'';
                const mE=document.getElementById('fuelModel');if(data.model.status==='fallback'){mE.className='fuel-model fallback';mE.textContent='âš ï¸ '+(data.model.fallback||'Codex');}else{mE.className='fuel-model ok';mE.textContent='ðŸ§  '+(data.model.active||'Opus');}
                if(data.thinking){document.querySelector('#thinkHigh .pill-count').textContent=data.thinking.high||0;document.querySelector('#thinkMed .pill-count').textContent=data.thinking.medium||0;document.querySelector('#thinkLow .pill-count').textContent=data.thinking.low||0;const a=document.getElementById('thinkActive');if(data.thinking.current)a.textContent='â–¸ Now: '+data.thinking.current;}
                const u=document.getElementById('fuelUpdated');if(data.updatedAt){const d=new Date(data.updatedAt);u.textContent='â± '+d.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});u.title='Last updated by '+(data.updatedBy||'ChetGPT');}
            }
            async function fetchFuel(){try{const r=await fetch('usage.json?_='+Date.now(),{cache:'no-store'});if(!r.ok)return;renderFuel(await r.json());}catch(e){}}
            fetchFuel();setInterval(fetchFuel,FUEL_INTERVAL);
        })();

        // === LIVE UPDATE CHECKER ===
        (function(){
            const CI=30000;let ct='';const m=document.documentElement.innerHTML.match(/SYNC_TIMESTAMP:\s*([^\n<]+)/);if(m)ct=m[1].trim();let banner=null;
            function createBanner(){if(banner)return;banner=document.createElement('div');banner.id='live-update-banner';banner.innerHTML='ðŸ”„ Board updated â€” <strong>tap to refresh</strong>';banner.addEventListener('click',()=>location.reload());document.body.appendChild(banner);}
            async function check(){try{const r=await fetch(location.href+'?_='+Date.now(),{cache:'no-store'});const t=await r.text();const m=t.match(/SYNC_TIMESTAMP:\s*([^\n<]+)/);if(m){const rt=m[1].trim();if(ct&&rt!==ct)createBanner();}}catch(e){}}
            setInterval(check,CI);
        })();
    </script>
</body>
</html>
